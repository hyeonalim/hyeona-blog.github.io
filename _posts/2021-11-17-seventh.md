---
layout: post
title: "[Concept] Process와 Thread 차이, Stack 과 Heap"
subtitle: "프로세스와 스레드 차이, 스택과 힙"
date: 2021-11-17 11:00:00 +0900
background: '/img/posts/06.jpg'
---

목차  
[1. 프로세스와 스레드 차이](#프로세스와-스레드-차이)  
[2. 스택과 힙](#스택과-힙)

# 프로세스와 스레드 차이  
## 프로세스 개념
프로세스(Process): 실행 중인 프로그램으로 CPU와 메모리 등이 활성화됨  

멀티(다중) 프로세스란?
- 여러개의 프로세스를 실행 중인 것
- 멀티 프로세스 지원은 주로 운영체제, 윈도우 와 맥 OS

## 스레드 개념
스레드(Thread): 어떤 프로그램이나 프로세스 내에서 실행되는 흐름의 단위  독립적으로 동작
프로세스 안에 여러개의 스레드가 존재

싱글 스레드: 하나의 스레드만을 가르키며 주로 main 스레드

멀티(다중) 스레드: 각각 안에 여러 스레드가 돌아간다

<details>
<summary>간단한 개념 설명</summary>
<div markdown="1">
※ 리소스: 사용될 수 있는 어떤 항목  
ex) CPU, 메모리 등

※ CPU(central processing unit)
- 흔히 중앙 '처리' 장치로, 문맥 교환을 통해 전환 속도가 빠른 장치
- 기억, 해석, 연산, 제어라는 4대 주요 기능

※ 컨텍트 스위칭(Context switching)
- 각자 조금씩 동작하는 것
- 하나의 프로세스가 CPU를 사용 중인 상태에서 다른 프로세스가 CPU를 사용하도록 하기 위함
- 이전의 프로세스의 상태를 보관하고 새로운 프로세스의 상태를 적재
- 프로세스의 문맥은 그 프로세스의 제어 블록에 저장

※프로세스 제어 블록(PCB, Process Control Block)
- 특정한 프로세스를 관리할 필요가 있는 정보를 포함하는 운영체제 커널의 자료 구조
- 운영체제가 프로세스를 표현한 것

※ 메모리(RAM, Random Access Memory)란?
- 휘발성으로 데이터 정리하는 공간
- 속도는 빠르지만 용량이 낮다
- 프로세스가 메모리에 할당되면 각각의 프로세스는 동일한 크기의 메모리를 할당
- 종류: 논리, 물리, 가상 메모리
- 논리 메모리: 프로세스가 가진 주소
- 물리 메모리: 실제 메모리의 주소
- 가상 메모리: 논리 메모리와 물리 메모리의 크기 한계를 극복하기 위해, 프로세스에서 필요한 부분만 메모리로 올리는 Demand-Paging 기법을 사용

※ 요구 페이징(Demand paging)이란?
- OS에서 가상 메모리 관리 방법
- 디스크 페이지를 실제 메모리에 복사하려고 시도하고, 해당 페이지가 메모리에 없는 경우에만 실제 메모리에 디스크 페이지를 복사한다.

※ 디스크(ROM, Read-only memory)란?
- 비휘발성으로 데이터 정리
- 속도는 느림

※ 메모리 구조
- 프로그램이 실행되려면 메모리에 로드가 되어야 하며 변수들을 저장할 메모리 필요
- 메모리 공간: 코드, 데이터, 스택, 힙

※ 코드 영역
- 실행할 프로그램의 코드가 저장되는 영역
- CPU는 코드 영역에 저장된 명령어를 하나씩 가져가서 처리

※ 데이터 영역
- 프로그램의 전역 변수, 정적 변수가 저장되는 영역
- 프로그램의 시작과 함께 할당되며 종료되면 소멸된다.

</div>
</details>

# 스택과 힙
변수: 데이터를 저장하는 곳
기본형 타입(Primitive type): 실제 값을 저장하는 공간으로 스택 메모리에 저장된다.  
참조형 타입(Reference type): Heap, 값이 저장되어 있는 곳의 주소값을 저장하는 곳

    int num = 0;
    Scanner scn = new Scanner();

위 내용에서 기본형 타입은 num, 참조형 타입은 scn이다.

## 스택
- 함수의 호출과 관계되는 지역 변수와 매개변수가 저장되는 영역
- 푸시(push) 동작으로 데이터를 저장하고, 팝(pop) 동작으로 데이터를 인출한다.

- 각 스레드당 하나씩 생성된다.

※ 스택 프레임(stack frame)
스택 영역에 저장되는 함수의 호출 정보

※ 후입선출(LIFO, Last-In First-Out) 방식에 따라 동작하므로, 가장 늦게 저장된 데이터가 가장 먼저 인출됩니다.

- 데이터 용량은 메모리의 높은 주소에서 낮은 주소의 방향으로 할당된다.


## 힙
- 참조 타입이 힙에 저장된다.
- 사용자가 직접 관리할 수 있는 영역
- 사용자에 의해 메모리 공간이 동적으로 할당, 해제된다.
- 런 타임에 크기가 결정된다.
- 메모리의 낮은 주소에서 높은 주소의 방향으로 할당된다.
(높은 주소: 스택 영역 근처)
- 데이터 용량은 해당 공간의 모든 값을 계산한 값이 나와야 한다.

스택에서 만들어진 변수가 포인터라면, 힙에 포인터의 값이 들어간다. 만약, heap에서 사용한 값을 같은 heap이지만 가지가 다른 값을 넣으려면 아래와 같이 사용한다.

    b.cashief.ccc.age = 0;
    
가지치기 되어 있는 변수를 사용하고 싶을 땐 참조를 따라가면 쉽게 적용할 수 있다.

## 스택과 힙의 차이
스택
- 크기: 스택 크기에 제한
- 그외: 변수의 크기 조정 불가하다. CPU에 의해 효율적으로 관리되고 메모리는 단편화 X

힙
- 크기: 제한 X, 관리 필요
- 그외: 변수가 전역적으로 액세스 가능
- 효율적인 공간 사용을 보장하지 못하면 메모리 블록이 할당 된 후 시간이 지남에 따라 메모리가 조각화되어 해제 될 수 있습니다.

※ 메모리 단편화
?

※ 메모리 조각화
?